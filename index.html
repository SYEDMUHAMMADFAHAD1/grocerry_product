<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Noto+Sans+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        
        .urdu-font {
            font-family: 'Noto Sans Arabic', sans-serif;
        }
        
        .category-card {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .product-card {
            transition: all 0.3s ease;
            border: 1px solid #e2e8f0;
        }
        .product-card:hover {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .price-edit-mode {
            background-color: #fef3cd;
            border: 2px dashed #f59e0b;
        }

        /* Logo Styles */
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center; /* Center the whole container */
            gap: 15px;
        }
        
        .logo-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #fcfffd 0%, #363434 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
            flex-shrink: 0; /* Prevent icon from shrinking */
        }

        .logo-container .text-center {
            text-align: center; /* Ensure text inside is centered */
        }

        /* Search Styles */
        .search-container {
            position: relative;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgb(53, 54, 84);
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            z-index: 50;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .search-item {
            padding: 12px 16px;
            border-bottom: 1px solid #080808;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .search-item:hover {
            background-color: #4d38c0;
        }
        
        .search-item:last-child {
            border-bottom: none;
        }

        /* Language Toggle */
        .language-toggle {
            display: flex;
            background: white;
            border-radius: 25px;
            padding: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .language-btn {
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 14px;
        }
        
        .language-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .language-btn:not(.active) {
            color: #6b7280;
        }

        /* Weight Control Styles */
        .weight-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .weight-btn {
            padding: 4px 8px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            min-width: 50px;
        }
        
        .weight-btn:hover {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            transform: translateY(-1px);
        }
        
        .weight-display {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            min-width: 80px;
            text-align: center;
        }

        /* --- UPDATED BILL STYLES --- */
        .bill-print-content {
            font-family: 'Courier New', monospace;
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            color: black;
        }
        
        .bill-header {
            text-align: center;
            padding-bottom: 15px;
            margin-bottom: 15px;
            border-bottom: 2px solid #000;
        }

        .bill-top-heading {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 15px;
        }

        .bill-top-heading h1 {
            font-size: 2.5rem;
            font-weight: bold;
            line-height: 1;
        }

        .since-text {
            font-weight: bold;
            font-size: 1rem;
        }

        .store-name-subheading {
            font-weight: bold;
            font-size: 1.8rem;
            line-height: 1.4;
        }

        .store-name-subheading p {
            margin: 0;
        }

        .bill-header h2, .logo-brand, .store-tagline-print, .store-description-print {
            display: none;
        }
        
        .bill-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        
        .bill-table th {
            font-weight: bold;
            padding: 8px 4px;
            text-align: left;
            font-size: 20px;
            border-bottom: 2px solid #000;
            color: black;
        }
        
        .bill-table td {
            padding: 8px 4px;
            font-size: 16px;
            border-bottom: none; /* REMOVED dotted underline */
            color: black;
            font-weight: bold; /* ADDED bold as requested */
        }
        
        .bill-table .text-right {
            text-align: right;
        }
        
        .bill-total {
            padding-top: 10px;
            margin-top: 15px;
            border-top: 2px solid #000;
        }
        
        .bill-total-row {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            color: black;
        }
        
        .bill-footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed #666;
            font-size: 12px;
            color: black;
            font-weight: bold;
        }
        
        .bill-number {
            text-align: center;
            font-size: 12px;
            margin-top: 15px;
            font-weight: bold;
            color: black;
        }

        /* --- UPDATED PRINT STYLES --- */
        @media print {
            @page {
                size: A4;
                margin: 0.5in;
            }
            
            * {
                visibility: hidden;
            }
            
            .print-area, .print-area * {
                visibility: visible !important;
            }
            
            .print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
                background: white !important;
            }
            
            .bill-print-content {
                width: 100% !important;
                max-width: none !important;
                margin: 0 auto !important;
                padding: 20px !important;
                color: black !important;
                background: white !important;
            }
            
            .bill-header {
                border-bottom: 2px solid #000 !important;
                margin-bottom: 20px !important;
                padding-bottom: 15px !important;
            }
            
            .bill-top-heading h1 {
                font-size: 4.5rem !important;
            }

            .since-text {
                font-size: 2rem !important;
            }

            .store-name-subheading {
                font-size: 2rem !important;
                line-height: 2 !important;
            }
            
            .bill-table {
                width: 100% !important;
                border-collapse: collapse !important;
                margin-bottom: 30px !important;
            }
            
            .bill-table th {
                font-weight: bold !important;
                padding: 10px 5px !important;
                font-size: 30px !important;
                border-bottom: 2px solid #000 !important;
                color: black !important;
            }
            
            .bill-table td {
                padding: 8px 5px !important;
                font-size: 30px !important;
                border-bottom: none !important;
                color: black !important;
                font-weight: bold !important;
            }
            
            .bill-total {
                border-top: 2px solid #000 !important;
                padding-top: 15px !important;
                margin-top: 30px !important;
            }
            
            .bill-total-row {
                font-size: 30px !important;
                font-weight: bold !important;
                color: black !important;
                margin-bottom: 15px !important;
            }
            
            .bill-footer {
                border-top: 1px dashed #000 !important;
                padding-top: 15px !important;
                margin-top: 20px !important;
                font-size: 30px !important;
                color: black !important;
                font-weight: bold !important;
            }
            
            .bill-number {
                font-size: 30px !important;
                font-weight: bold !important;
                color: black !important;
                margin-top: 15px !important;
            }
            
            .logo-icon-print {
                display: none !important;
            }
            
            .no-print {
                display: none !important;
            }
        }

        /* Cart styles for better mobile responsiveness */
        .cart-section {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            border-top: 3px solid #667eea;
        }
        
        /* RTL Support for Urdu */
        .rtl {
            direction: rtl;
            text-align: right;
        }
        
        .rtl .search-container {
            direction: ltr; /* Keep search input LTR even in RTL mode */
        }
        
        .rtl .bill-table th,
        .rtl .bill-table td {
            text-align: right;
        }
        
        .rtl .bill-table .text-right {
            text-align: left;
        }

        /* PDF Export Optimization */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .dashboard-section {
            page-break-inside: avoid;
        }
        
        .cart-content {
            page-break-inside: avoid;
        }

        /* Responsive adjustments for better PDF export */
        @media screen and (max-width: 768px) {
            .categories-grid {
                grid-template-columns: 1fr;
            }
            .products-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Specific styles for the bill modal content to be bold and slightly larger */
        #billDetails p {
            font-weight: bold;
            font-size: 1.1em; /* Slightly larger */
        }

        /* --- Responsive Enhancements --- */

        /* Header responsiveness */
        @media (max-width: 768px) {
            header .container {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            header .flex.justify-between.items-center {
                flex-direction: column;
                gap: 1rem; /* Space out items vertically */
            }

            header .logo-container {
                flex-direction: column;
                gap: 0.5rem;
            }

            header .text-right {
                text-align: center;
                margin-top: 1rem;
            }

            header .language-toggle {
                margin-top: 1rem;
            }

            .logo-container .logo-icon {
                width: 50px;
                height: 50px;
            }

            .logo-container .text-center h1 {
                font-size: 1.75rem; /* Smaller for mobile */
            }

            .logo-container .text-center p {
                font-size: 0.75rem; /* Smaller tagline */
            }
        }

        /* Main content grids responsiveness */
        @media (max-width: 640px) {
            .categories-grid,
            .products-grid {
                grid-template-columns: 1fr; /* Single column on very small screens */
                gap: 1rem;
            }
        }

        /* Dashboard responsiveness */
        @media (max-width: 768px) {
            .dashboard-section .grid-cols-1.lg:grid-cols-2 {
                grid-template-columns: 1fr; /* Stack dashboard columns on mobile */
            }
        }

        /* Cart section responsiveness */
        @media (max-width: 768px) {
            .cart-content .grid-cols-1.lg:grid-cols-3 {
                grid-template-columns: 1fr; /* Stack cart sections on mobile */
            }
            .cart-content .lg:col-span-2 {
                margin-bottom: 1.5rem; /* Add space between stacked cart items and summary */
            }
        }

        /* Footer responsiveness */
        @media (max-width: 768px) {
            footer .grid.grid-cols-1.md:grid-cols-4 {
                grid-template-columns: 1fr; /* Stack footer columns on mobile */
                text-align: center;
            }
            footer .md:col-span-2 {
                display: none; /* Hide the empty column on mobile */
            }
        }

        /* Weight control buttons responsiveness */
        @media (max-width: 480px) {
            .weight-controls {
                flex-direction: column; /* Stack buttons vertically on very small screens */
                gap: 5px;
            }
            .weight-btn {
                width: 100%; /* Full width for stacked buttons */
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <header class="gradient-bg text-white py-6 shadow-lg no-print">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center space-x-4 mb-4 md:mb-0">
                    <button id="adminToggle" class="bg-white bg-opacity-20 px-4 py-2 rounded-lg hover:bg-opacity-30 transition text-sm md:text-base">
                        <i class="fas fa-user-cog mr-2"></i><span data-translate="admin_mode">Admin Mode</span>
                    </button>
                    <div class="language-toggle">
                        <div class="language-btn active" onclick="changeLanguage('en')">EN</div>
                        <div class="language-btn" onclick="changeLanguage('ur')">اردو</div>
                    </div>
                </div>
                
                <div class="logo-container mb-4 md:mb-0">
                    <div class="logo-icon">
                        <i class="fas fa-shopping-basket text-2xl text-white"></i>
                    </div>
                    <div class="text-center">
                        <h1 class="text-2xl md:text-3xl font-bold" data-translate="store_name">حاجی فخرالدین کریانہ اینڈ جنرل ہولسیل اسٹور</h1>
                        <p class="text-xs md:text-sm opacity-90" data-translate="store_tagline">All types of rice, various lentils, spices, and premium dry fruits are available here at reasonable prices.</p>
                    </div>
                </div>
                
                <div class="text-center md:text-right">
                    <div class="text-sm opacity-90" data-translate="total_sales_today">Total Sales Today</div>
                    <div class="text-xl font-bold" id="totalSalesToday">0 PKR</div>
                </div>
            </div>
            
            <div class="search-container mt-6">
                <div class="relative">
                    <input type="text" id="searchInput" 
                        class="w-full px-4 py-3 pl-12 pr-4 text-black bg-white rounded-lg shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-300" 
                        data-translate-placeholder="search_placeholder" 
                        placeholder="Search for grocery items...">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-search text-gray-400"></i>
                    </div>
                </div>
                <div id="searchResults" class="search-results hidden"></div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 no-print">
        <section class="mb-12" id="categoriesSection">
            <h2 class="text-2xl md:text-3xl font-bold text-center mb-8 text-gray-800">
                <i class="fas fa-th-large mr-3 text-blue-600"></i><span data-translate="shop_by_category">Shop by Category</span>
            </h2>
            <div class="categories-grid" id="categoriesGrid">
                </div>
        </section>

        <section id="productsSection" class="hidden">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4 md:mb-0" id="categoryTitle"></h2>
                <button id="backToCategories" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition">
                    <i class="fas fa-arrow-left mr-2"></i><span data-translate="back_to_categories">Back to Categories</span>
                </button>
            </div>
            <div class="products-grid" id="productsGrid">
                </div>
        </section>

        <section class="dashboard-section mt-12 bg-white rounded-lg shadow-lg p-6">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4 md:mb-0">
                    <i class="fas fa-chart-line mr-3 text-green-600"></i><span data-translate="sales_dashboard">Sales Dashboard</span>
                </h2>
                <button id="resetSalesBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition">
                    <i class="fas fa-refresh mr-2"></i><span data-translate="reset_daily_sales">Reset Daily Sales</span>
                </button>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4" data-translate="daily_sales_summary">Daily Sales Summary</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                            <span data-translate="total_items_sold">Total Items Sold:</span>
                            <span class="font-bold text-blue-600" id="totalItemsSold">0</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                            <span class="font-bold text-green-600" id="totalRevenue">0 PKR</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-purple-50 rounded-lg">
                            <span data-translate="total_orders">Total Orders:</span>
                            <span class="font-bold text-purple-600" id="totalOrders">0</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-orange-50 rounded-lg">
                            <span data-translate="average_order_value">Average Order Value:</span>
                            <span class="font-bold text-orange-600" id="avgOrderValue">0 PKR</span>
                        </div>
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4" data-translate="recent_sales">Recent Sales</h3>
                    <div id="recentSales" class="space-y-2 max-h-64 overflow-y-auto">
                        </div>
                </div>
            </div>
        </section>
    </main>

    <section class="cart-section py-8 no-print">
        <div class="container mx-auto px-4">
            <div class="cart-content bg-white rounded-lg shadow-lg p-6 max-w-4xl mx-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl md:text-2xl font-semibold flex items-center">
                        <i class="fas fa-shopping-cart mr-3 text-blue-600"></i><span data-translate="shopping_cart">Shopping Cart</span>
                    </h3>
                    <span class="bg-blue-600 text-white px-3 py-1 rounded-full text-lg font-bold" id="cartCount">0</span>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <div id="cartItems" class="max-h-80 overflow-y-auto mb-4">
                            <p class="text-gray-500 text-center py-8" data-translate="cart_empty">Cart is empty</p>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <div class="space-y-4">
                            <div class="flex justify-between items-center text-xl font-bold border-b pb-4">
                                <span data-translate="total">Total:</span>
                                <span id="cartTotal" class="text-green-600">0 PKR</span>
                            </div>
                            <button id="checkoutBtn" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition text-lg font-semibold">
                                <i class="fas fa-credit-card mr-2"></i><span data-translate="checkout">Checkout</span>
                            </button>
                            <button id="clearCartBtn" class="w-full bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 transition text-lg font-semibold">
                                <i class="fas fa-trash mr-2"></i><span data-translate="clear_cart">Clear Cart</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div id="billPrintArea" class="print-area" style="display: none;">
        </div>

    <div id="billModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 no-print">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <div class="text-center mb-6">
                <i class="fas fa-receipt text-4xl text-green-600 mb-4"></i>
                <h3 class="text-2xl font-bold text-gray-800" data-translate="order_summary">Order Summary</h3>
            </div>
            <div id="billDetails" class="space-y-2 mb-6"></div>
            <div class="border-t pt-4">
                <div class="flex justify-between items-center text-xl font-bold">
                    <span data-translate="total_amount">Total Amount:</span>
                    <span id="billTotal" class="text-green-600">0 PKR</span>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 mt-6">
                <button id="printBill" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
                    <i class="fas fa-print mr-2"></i><span data-translate="print">Print</span>
                </button>
                <button id="closeBill" class="flex-1 bg-gray-600 text-white py-2 rounded-lg hover:bg-gray-700 transition">
                    <span data-translate="close">Close</span>
                </button>
            </div>
        </div>
    </div>

    <footer class="bg-gray-800 text-white py-8 mt-12 no-print">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4" data-translate="store_name"></h3>
                    <p class="text-gray-300" data-translate="store_description"></p>
                </div>
                <div class="hidden md:block"></div> <div>
                    <h3 class="text-lg font-semibold mb-4" data-translate="connect_with_us">Connect With Us</h3>
                    <p class="text-gray-300"><i class="fas fa-phone mr-2"></i>0325-3545682</p>
                    <p class="text-gray-300"><i class="fas fa-phone mr-2"></i>0341-3020958</p>
                </div>
            </div>
            <div class="border-t border-gray-700 pt-8 mt-8 text-center text-gray-400">
                <p data-translate="copyright">&copy; 2025 GroceryMart. All rights reserved. Made with <i class="fas fa-heart text-red-500"></i> in Pakistan</p>
            </div>
        </div>
    </footer>

    <script>
        // Translation Data
        const translations = {
            en: {
                store_name: "Haji Fakhruddin Grocery & General Wholesale Store",
                store_tagline: "All types of rice, various lentils, spices, and premium dry fruits are available here at reasonable prices.",
                store_description: "We have all types of rice, all types of lentils, hot spices and the best dry fruits available at reasonable prices",
                admin_mode: "Admin Mode",
                search_placeholder: "Search for grocery items...",
                shop_by_category: "Shop by Category",
                back_to_categories: "Back to Categories",
                sales_dashboard: "Sales Dashboard",
                reset_daily_sales: "Reset Daily Sales",
                daily_sales_summary: "Daily Sales Summary",
                total_items_sold: "Total Items Sold:",
                total_revenue: "Total Revenue:",
                total_orders: "Total Orders:",
                average_order_value: "Average Order Value:",
                recent_sales: "Recent Sales",
                shopping_cart: "Shopping Cart",
                cart_empty: "Cart is empty",
                total: "Total:",
                checkout: "Checkout",
                clear_cart: "Clear Cart",
                total_sales_today: "Total Sales Today",
                order_summary: "Order Summary",
                total_amount: "Total Amount:",
                print: "Print",
                close: "Close",
                connect_with_us: "Connect With Us",
                copyright: "&copy; 2025 GroceryMart. All rights reserved. Made with ❤️ in Pakistan",
                thank_you: "Thank you for your business!",
                visit_again: "Visit us again!",
                bill_description: "Description",
                bill_weight: "Weight",
                bill_price: "Price",
                bill_total: "Total",
                bill_final_total: "TOTAL:",
                add_to_cart: " Add",
                phone1: "Phone: 0325-3545682",
                phone2: "Phone: 0341-3020958",
                // Category Translations (English)
                "Ghee": "Ghee",
                "Oils": "Oils",
                "Mixed Lentils": "Mixed Lentils",
                "Wheat & Rice": "Wheat & Rice",
                "Flour": "Flour",
                "Sugar": "Sugar",
                "Millets & Grains": "Millets & Grains",
                "Chickpeas": "Chickpeas",
                "Mixed Spices": "Mixed Spices",
                "Lazzat Masala Sachets": "Lazzat Masala Sachets",
                "Premium Spices": "Premium Spices",
                "Dry Fruits": "Dry Fruits",
                "Other Items": "Other Items"
            },
            ur: {
                store_name: "باغ عزیز",
                store_tagline: "حاجی فخرالدین کریانہ اینڈ جنرل ہولسیل اسٹور",
                store_description: "ہمارے یہاں ہر قسم کے چاول ہر قسم کے دالیں گرم مصالحہ جات اور بہترین ڈرایٔ فروٹ مناسب قیمت پر دستیاب ہیں",
                admin_mode: "ایڈمن موڈ",
                search_placeholder: "کریانہ سامان تلاش کریں...",
                shop_by_category: "کیٹگری کے ذریعے خریداری کریں",
                back_to_categories: "کیٹگری میں واپس",
                sales_dashboard: " سیلز ڈیش بورڈ",
                reset_daily_sales: " یومیہ سیلز ری سیٹ کریں",
                daily_sales_summary: "یومیہ سیلز خلاصہ",
                total_items_sold: "کل فروخت شدہ اشیاء:",
                total_revenue: "کل آمدنی:",
                total_orders: "کل آرڈرز:",
                average_order_value: "اوسط آرڈر ویلیو:",
                recent_sales: "حالیہ سیلز",
                shopping_cart: "شاپنگ کارٹ",
                cart_empty: "کارٹ خالی ہے",
                total: "کل:",
                checkout: " چیک آؤٹ",
                clear_cart: " کارٹ صاف کریں",
                total_sales_today: "آج کی کل سیلز",
                order_summary: "آرڈر کا خلاصہ",
                total_amount: "کل رقم:",
                print: " پرنٹ",
                close: " بند کریں",
                connect_with_us: "ہم سے رابطہ کریں",
                copyright: "&copy; 2025 GroceryMart. تمام حقوق محفوظ ہیں۔ پاکستان میں ❤️ کے ساتھ بنایا گیا",
                thank_you: "آپ کے کاروبار کے لیے شکریہ!",
                visit_again: "دوبارہ تشریف لائیں!",
                bill_description: "تفصیل",
                bill_weight: "وزن",
                bill_price: "قیمت",
                bill_total: "کل",
                bill_final_total: "کل رقم",
                add_to_cart: "شامل کریں",
                phone1: "فون: 3545682-0325",
                phone2: "فون: 3020958-0341",
                // Category Translations (Urdu)
                "Ghee": "گھی",
                "Oils": "تیل",
                "Mixed Lentils": "مکس دالیں",
                "Wheat & Rice": "گندم اور چاول",
                "Flour": "آٹا",
                "Sugar": "چینی",
                "Millets & Grains": "باجرہ اور اناج",
                "Chickpeas": "چنے",
                "Mixed Spices": "مکس مصالحے",
                "Lazzat Masala Sachets": "لذت مصالحہ ساشے",
                "Premium Spices": "پریمیم مصالحے",
                "Dry Fruits": "خشک میوہ جات",
                "Other Items": "دیگر اشیاء"
            }
        };

        // Product Data with Urdu translations and new items
        const groceryData = {
            "Ghee": [
                {name: "Taza Ghee 1 kg", nameUr: "تازہ گھی 1 کلو", price: 460, image: null},
                {name: "Taza Ghee 1/2 kg", nameUr: "تازہ گھی نصف کلو", price: 240, image: null},
                {name: "Taza Ghee 250g", nameUr: "تازہ گھی 250 گرام", price: 120, image: null},
                {name: "Kisan Ghee 1 kg", nameUr: "کسان گھی 1 کلو", price: 520, image: null}
            ],
            "Oils": [
                {name: "Kisan Oil 1 kg", nameUr: "کسان آئل 1 کلو", price: 520, image: null},
                {name: "Taza Oil 1 kg", nameUr: "تازہ آئل 1 کلو", price: 480, image: null},
                {name: "Naryal Tel 125g", nameUr: "ناریل کا تیل 125 گرام", price: 210, image: null},
                {name: "Naryal Tel 250g", nameUr: "ناریل کا تیل 250 گرام", price: 380, image: null},
                {name: "Sarso Tel 125g", nameUr: "سرسوں کا تیل 125 گرام", price: 130, image: null},
                {name: "Sarso Tel 250g", nameUr: "سرسوں کا تیل 250 گرام", price: 340, image: null},
                {name: "Tel Port Wekum 1 kg", nameUr: "تیل پورٹ ویکم 1 کلو", price: 440, image: null},
                {name: "Tel Olien 1 kg", nameUr: "تیل اولین 1 کلو", price: 430, image: null},
                {name: "Tel Sarso 1 kg", nameUr: "تیل سرسوں 1 کلو", price: 450, image: null}
            ],
            "Mixed Lentils": [
                {name: "Mong Dal A 1 kg", nameUr: "مونگ دال A 1 کلو", price: 390, image: null},
                {name: "Masoor Dal A 1 kg", nameUr: "مسور دال A 1 کلو", price: 280, image: null},
                {name: "Chana Dal VIP 1 kg", nameUr: "چنا دال وی آئی پی 1 کلو", price: 300, image: null},
                {name: "Mash Dal Khurmi 1 kg", nameUr: "ماش دال خورمی 1 کلو", price: 540, image: null},
                {name: "Masoor Dal Sabit 1 kg", nameUr: "مسور دال ثابت 1 کلو", price: 320, image: null}
            ],
            "Wheat & Rice": [
                {name: "Sabit Gandum 1 kg", nameUr: "ثابت گندم 1 کلو", price: 120, image: null},
                {name: "Lal Chawal 1 kg", nameUr: "لال چاول 1 کلو", price: 120, image: null},
                {name: "Chawal ka Atta VIP 1 kg", nameUr: "چاول کا آٹا وی آئی پی 1 کلو", price: 120, image: null},
                {name: "Chawal Tota 1 kg", nameUr: "چاول توتا 1 کلو", price: 180, image: null},
                {name: "Chawal Tota Premium 1 kg", nameUr: "چاول توتا پریمیم 1 کلو", price: 220, image: null},
                {name: "Chawal Puniya 1 kg", nameUr: "چاول پنیا 1 کلو", price: 280, image: null},
                {name: "Chawal Sela 1 kg", nameUr: "چاول سیلا 1 کلو", price: 370, image: null},
                {name: "Chawal Mohabbat Basmati 1 kg", nameUr: "چاول محبت بسمتی 1 کلو", price: 370, image: null},
                {name: "Chawal Basmati Sahil 1 kg", nameUr: "چاول بسمتی ساحل 1 کلو", price: 390, image: null},
                {name: "Chawal Mota C9 1 kg", nameUr: "چاول موٹا C9 1 کلو", price: 240, image: null}
            ],
            "Flour": [
                {name: "Chakki Aata 5 kg", nameUr: "چکی آٹا 5 کلو", price: 520, image: null},
                {name: "Aata 10 kg", nameUr: "آٹا 10 کلو", price: 740, image: null},
                {name: "Normal Aata 1 kg", nameUr: "عام آٹا 1 کلو", price: 80, image: null},
                {name: "Fine Aata 1 kg", nameUr: "فائن آٹا 1 کلو", price: 90, image: null},
                {name: "Besan Special 1 kg", nameUr: "بیسن سپیشل 1 کلو", price: 320, image: null}
            ],
            "Sugar": [
                {name: "Cheeni Special 1 kg", nameUr: "چینی سپیشل 1 کلو", price: 190, image: null}
            ],
            "Millets & Grains": [
                {name: "Bajra Mota 1 kg", nameUr: "باجرہ موٹا 1 کلو", price: 140, image: null},
                {name: "Bajra Kangni 1 kg", nameUr: "باجرہ کنگنی 1 کلو", price: 200, image: null},
                {name: "VIP Dalya 1 kg", nameUr: "وی آئی پی دلیہ 1 کلو", price: 140, image: null}
            ],
            "Chickpeas": [
                {name: "Safaid Chana 10mm 1 kg", nameUr: "سفید چنا 10 ملی میٹر 1 کلو", price: 440, image: null},
                {name: "Kala Chana VIP 1 kg", nameUr: "کالا چنا وی آئی پی 1 کلو", price: 280, image: null},
                {name: "Chora VIP 1 kg", nameUr: "چورا وی آئی پی 1 کلو", price: 320, image: null},
                {name: "Mori VIP 1 kg", nameUr: "موری وی آئی پی 1 کلو", price: 320, image: null},
                {name: "White Lobia VIP 1 kg", nameUr: "سفید لوبیا وی آئی پی 1 کلو", price: 440, image: null},
                {name: "Bhuna Chana 1 kg", nameUr: "بھنا چنا 1 کلو", price: 400, image: null}
            ],
            "Mixed Spices": [
                {name: "Pisi Mirch 1 kg", nameUr: "پسی مرچ 1 کلو", price: 1000, image: null},
                {name: "Kuti Mirch 1 kg", nameUr: "کٹی مرچ 1 کلو", price: 1000, image: null},
                {name: "Sabit Mirch 1 kg", nameUr: "ثابت مرچ 1 کلو", price: 1200, image: null},
                {name: "Pisi Haldi VIP 1 kg", nameUr: "پسی ہلدی وی آئی پی 1 کلو", price: 1000, image: null},
                {name: "Pisi Dhania VIP 1 kg", nameUr: "پسا دھنیا وی آئی پی 1 کلو", price: 800, image: null},
                {name: "Mix Masala VIP 1 kg", nameUr: "مکس مسالہ وی آئی پی 1 کلو", price: 800, image: null},
                {name: "Safaid Zeera VIP 1 kg", nameUr: "سفید زیرہ وی آئی پی 1 کلو", price: 1600, image: null},
                {name: "Kali Mirch VIP 1 kg", nameUr: "کالی مرچ وی آئی پی 1 کلو", price: 2400, image: null},
                {name: "Methi Dana 1 kg", nameUr: "میتھی دانا 1 کلو", price: 500, image: null},
                {name: "Ajwain VIP 1 kg", nameUr: "اجوائن وی آئی پی 1 کلو", price: 500, image: null},
                {name: "Sarso Dana VIP 1 kg", nameUr: "سرسوں دانا وی آئی پی 1 کلو", price: 500, image: null},
                {name: "Sabit Dhania Goli 1 kg", nameUr: "ثابت دھنیا گولی 1 کلو", price: 800, image: null},
                {name: "Sabit Dhania Desi 1 kg", nameUr: "ثابت دھنیا دیسی 1 کلو", price: 1200, image: null},
                {name: "Chat Masala Khulla 1 kg", nameUr: "چاٹ مسالہ کھلا 1 کلو", price: 600, image: null},
                {name: "Finger Chips Masala 1 kg", nameUr: "فنگر چپس مسالہ 1 کلو", price: 800, image: null}
            ],
            "Lazzat Masala Sachets": [
                {name: "Lazzat Biryani 1 pcs", nameUr: "لذت بریانی 1 پیس", price: 10, image: null},
                {name: "Lazzat Karahi 1 pcs", nameUr: "لذت کڑاہی 1 پیس", price: 10, image: null},
                {name: "Lazzat Achar Gosht 1 pcs", nameUr: "لذت اچار گوشت 1 پیس", price: 10, image: null},
                {name: "Lazzat Qourma 1 pcs", nameUr: "لذت قورمہ 1 پیس", price: 10, image: null},
                {name: "Lazzat Machli 1 pcs", nameUr: "لذت مچھلی 1 پیس", price: 10, image: null},
                {name: "Lazzat Nihari 1 pcs", nameUr: "لذت نہاری 1 پیس", price: 20, image: null},
                {name: "Lazzat Shami Kabab 1 pcs", nameUr: "لذت شامی کباب 1 پیس", price: 20, image: null},
                {name: "Lazzat Qeema Fry 1 pcs", nameUr: "لذت قیمہ فرائی 1 پیس", price: 10, image: null},
                {name: "Lazzat Daal Fry 1 pcs", nameUr: "لذت دال فرائی 1 پیس", price: 10, image: null},
                {name: "Lazzat Kofta 1 pcs", nameUr: "لذت کوفتہ 1 پیس", price: 10, image: null},
                {name: "Lazzat Paya 1 pcs", nameUr: "لذت پایا 1 پیس", price: 20, image: null},
                {name: "Lazzat Haleem 1 pcs", nameUr: "لذت حلیم 1 پیس", price: 20, image: null},
                {name: "Lazzat White Karahi 1 pcs", nameUr: "لذت وائٹ کڑاہی 1 پیس", price: 20, image: null},
                {name: "Lazzat Chasni 1 pcs", nameUr: "لذت چاشنی 1 پیس", price: 20, image: null},
                {name: "Lazzat Chicken Masala 1 pcs", nameUr: "لذت چکن مسالہ 1 پیس", price: 10, image: null},
                {name: "Lazzat Tikka Boti 1 pcs", nameUr: "لذت ٹکہ بوٹی 1 پیس", price: 10, image: null}
            ],
            "Premium Spices": [
                {name: "Elaichi Sabz 10g", nameUr: "الائچی سبز 10 گرام", price: 100, image: null},
                {name: "Elaichi Sabz 25g", nameUr: "الائچی سبز 25 گرام", price: 240, image: null},
                {name: "Elaichi Sabz 50g", nameUr: "الائچی سبز 50 گرام", price: 480, image: null},
                {name: "Long 25g", nameUr: "لونگ 25 گرام", price: 150, image: null},
                {name: "Long 50g", nameUr: "لونگ 50 گرام", price: 300, image: null},
                {name: "Darchini 25g", nameUr: "دارچینی 25 گرام", price: 60, image: null},
                {name: "Darchini 50g", nameUr: "دارچینی 50 گرام", price: 120, image: null},
                {name: "Badiyan 25g", nameUr: "بادیان 25 گرام", price: 80, image: null},
                {name: "Badiyan 50g", nameUr: "بادیان 50 گرام", price: 160, image: null},
                {name: "Kabab Cheeni 25g", nameUr: "کباب چینی 25 گرام", price: 100, image: null},
                {name: "Kabab Cheeni 50g", nameUr: "کباب چینی 50 گرام", price: 200, image: null},
                {name: "Jaifal 25g", nameUr: "جائفل 25 گرام", price: 120, image: null},
                {name: "Jaifal 50g", nameUr: "جائفل 50 گرام", price: 240, image: null},
                {name: "Javitri 25g", nameUr: "جاوتری 25 گرام", price: 200, image: null},
                {name: "Javitri 50g", nameUr: "جاوتری 50 گرام", price: 400, image: null},
                {name: "Tez Patta 25g", nameUr: "تیز پتا 25 گرام", price: 50, image: null},
                {name: "Tez Patta 50g", nameUr: "تیز پتا 50 گرام", price: 100, image: null},
                {name: "Piple 25g", nameUr: "پیپل 25 گرام", price: 80, image: null},
                {name: "Piple 50g", nameUr: "پیپل 50 گرام", price: 160, image: null},
                {name: "Amla 25g", nameUr: "آملہ 25 گرام", price: 40, image: null},
                {name: "Amla 50g", nameUr: "آملہ 50 گرام", price: 80, image: null},
                {name: "Tukhmalo 50g", nameUr: "تخم بالنگا 50 گرام", price: 60, image: null},
                {name: "Tukhmalo 100g", nameUr: "تخم بالنگا 100 گرام", price: 120, image: null}
            ],
            "Dry Fruits": [
                {name: "Badam 250g", nameUr: "بادام 250 گرام", price: 400, image: null},
                {name: "Badam 500g", nameUr: "بادام 500 گرام", price: 800, image: null},
                {name: "Badam 1 kg", nameUr: "بادام 1 کلو", price: 1600, image: null},
                {name: "Pista 250g", nameUr: "پستہ 250 گرام", price: 500, image: null},
                {name: "Pista 500g", nameUr: "پستہ 500 گرام", price: 1000, image: null},
                {name: "Pista 1 kg", nameUr: "پستہ 1 کلو", price: 2000, image: null},
                {name: "Akhrot 250g", nameUr: "اخروٹ 250 گرام", price: 300, image: null},
                {name: "Akhrot 500g", nameUr: "اخروٹ 500 گرام", price: 600, image: null},
                {name: "Akhrot 1 kg", nameUr: "اخروٹ 1 کلو", price: 1200, image: null},
                {name: "Kaju 250g", nameUr: "کاجو 250 گرام", price: 600, image: null},
                {name: "Kaju 500g", nameUr: "کاجو 500 گرام", price: 1200, image: null},
                {name: "Kaju 1 kg", nameUr: "کاجو 1 کلو", price: 2400, image: null},
                {name: "Kishmish 250g", nameUr: "کشمش 250 گرام", price: 200, image: null},
                {name: "Kishmish 500g", nameUr: "کشمش 500 گرام", price: 400, image: null},
                {name: "Kishmish 1 kg", nameUr: "کشمش 1 کلو", price: 800, image: null},
                {name: "Khopra 250g", nameUr: "کھوپرا 250 گرام", price: 150, image: null},
                {name: "Khopra 500g", nameUr: "کھوپرا 500 گرام", price: 300, image: null},
                {name: "Khopra 1 kg", nameUr: "کھوپرا 1 کلو", price: 600, image: null},
                {name: "Chilgoza 250g", nameUr: "چلغوزہ 250 گرام", price: 1500, image: null},
                {name: "Chilgoza 500g", nameUr: "چلغوزہ 500 گرام", price: 3000, image: null},
                {name: "Chilgoza 1 kg", nameUr: "چلغوزہ 1 کلو", price: 6000, image: null},
                {name: "Anjeer 250g", nameUr: "انجیر 250 گرام", price: 400, image: null},
                {name: "Anjeer 500g", nameUr: "انجیر 500 گرام", price: 800, image: null},
                {name: "Anjeer 1 kg", nameUr: "انجیر 1 کلو", price: 1600, image: null},
                {name: "Badam Giri 250g", nameUr: "بادام گری 250 گرام", price: 500, image: null},
                {name: "Badam Giri 500g", nameUr: "بادام گری 500 گرام", price: 1000, image: null},
                {name: "Badam Giri 1 kg", nameUr: "بادام گری 1 کلو", price: 2000, image: null}
            ],
            "Other Items": [
                {name: "Imli", nameUr: "املی", price: 100, image: null},
                {name: "Alu Bukhara", nameUr: "آلو بخارا", price: 150, image: null},
                {name: "Hari Mirch", nameUr: "ہری مرچ", price: 50, image: null},
                {name: "Lehsun", nameUr: "لہسن", price: 80, image: null},
                {name: "Adrak", nameUr: "ادرک", price: 120, image: null},
                {name: "Pyaz", nameUr: "پیاز", price: 60, image: null},
                {name: "Tamatar", nameUr: "ٹماٹر", price: 70, image: null},
                {name: "Aalo", nameUr: "آلو", price: 40, image: null},
                {name: "Lemon", nameUr: "لیموں", price: 30, image: null},
                {name: "Kata Chana", nameUr: "کٹا چنا", price: 180, image: null}
            ]
        };

        let currentCategory = '';
        let cart = []; // { name, nameUr, basePrice, quantityGrams, displayWeight, totalItemPrice }
        let currentLanguage = 'en';
        let totalSalesToday = 0;
        let totalItemsSold = 0;
        let totalOrders = 0;
        let recentSales = [];
        const MAX_RECENT_SALES = 5; // Limit for recent sales display

        document.addEventListener('DOMContentLoaded', () => {
            loadSalesData();
            loadAdminModeState();
            applyLanguage('en'); 

            // **FIX**: Corrected the event listener for the back button
            document.getElementById('backToCategories').addEventListener('click', () => {
                document.getElementById('productsSection').classList.add('hidden');
                document.getElementById('categoriesSection').classList.remove('hidden');
                currentCategory = '';
            });
        });

        function changeLanguage(lang) {
            currentLanguage = lang;
            applyLanguage(lang);

            // Update active language button style
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.language-btn[onclick="changeLanguage('${lang}')"]`).classList.add('active');
        }

        function applyLanguage(lang) {
             if (lang === 'ur') {
                document.body.classList.add('rtl', 'urdu-font');
            } else {
                document.body.classList.remove('rtl', 'urdu-font');
            }

            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if(translations[lang] && translations[lang][key]) {
                    element.innerHTML = translations[lang][key];
                }
            });
             document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
                const key = element.dataset.translatePlaceholder;
                if (translations[lang] && translations[lang][key]) {
                    element.placeholder = translations[lang][key];
                }
            });
            
            renderCategories();
            if(currentCategory) {
                 renderProducts(currentCategory);
            }
            updateCartDisplay();
            updateSalesDashboard();
        }


        // Admin Mode Toggle
        const adminToggleBtn = document.getElementById('adminToggle');
        adminToggleBtn.addEventListener('click', toggleAdminMode);

        function toggleAdminMode() {
            document.body.classList.toggle('admin-mode');
            const isAdmin = document.body.classList.contains('admin-mode');
            localStorage.setItem('adminMode', isAdmin); // Save state
            
            renderCategories();
            if (currentCategory) {
                renderProducts(currentCategory);
            }
        }

        function loadAdminModeState() {
            const isAdmin = localStorage.getItem('adminMode') === 'true';
            if (isAdmin) {
                document.body.classList.add('admin-mode');
            }
        }

        function formatPrice(price) {
            return price.toLocaleString('en-PK', { style: 'currency', currency: 'PKR', minimumFractionDigits: 0 });
        }

        function renderCategories() {
            const categoriesGrid = document.getElementById('categoriesGrid');
            categoriesGrid.innerHTML = '';
            for (const category in groceryData) {
                const categoryCard = document.createElement('div');
                categoryCard.className = 'category-card bg-white rounded-lg shadow-md p-6 text-center cursor-pointer';
                categoryCard.innerHTML = `
                    <h3 class="text-xl font-semibold mb-2 text-white ${currentLanguage === 'ur' ? 'urdu-font' : ''}" data-translate="${category}">${translations[currentLanguage][category] || category}</h3>
                    <p class="text-white text-opacity-80">${groceryData[category].length} items</p>
                `;
                categoryCard.dataset.category = category;
                
                // **FIX**: Corrected the click handler to hide categories and show products
                categoryCard.addEventListener('click', () => {
                    currentCategory = category;
                    document.getElementById('categoriesSection').classList.add('hidden');
                    document.getElementById('productsSection').classList.remove('hidden');
                    renderProducts(category);
                });
                categoriesGrid.appendChild(categoryCard);
            }
        }

        function renderProducts(category) {
            if (!category) return;
            const productsGrid = document.getElementById('productsGrid');
            const categoryTitle = document.getElementById('categoryTitle');
            productsGrid.innerHTML = '';
            
            categoryTitle.textContent = translations[currentLanguage][category] || category;
            if(currentLanguage === 'ur') categoryTitle.classList.add('urdu-font');
            else categoryTitle.classList.remove('urdu-font');

            const products = groceryData[category];
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card bg-white rounded-lg shadow-md p-4 text-center relative';
                productCard.innerHTML = `
                    <h3 class="text-lg font-semibold mb-2 ${currentLanguage === 'ur' ? 'urdu-font' : ''}" data-name="${product.name}">${currentLanguage === 'ur' ? product.nameUr : product.name}</h3>
                    <p class="text-gray-600 mb-3" data-price="${product.price}">${formatPrice(product.price)} / kg</p>
                    <button class="add-to-cart-btn bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition ${currentLanguage === 'ur' ? 'urdu-font' : ''}"
                            data-product-name="${product.name}"
                            data-product-price="${product.price}"
                            data-product-name-ur="${product.nameUr}">
                        <i class="fas fa-cart-plus mr-2"></i><span data-translate="add_to_cart">${translations[currentLanguage].add_to_cart}</span>
                    </button>
                    ${document.body.classList.contains('admin-mode') ? `
                        <button class="edit-price-btn absolute top-2 right-2 bg-yellow-500 text-white p-2 rounded-full text-sm"
                                data-product-name="${product.name}" data-category="${category}">
                            <i class="fas fa-edit"></i>
                        </button>
                    ` : ''}
                `;
                productsGrid.appendChild(productCard);
            });

            productsGrid.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productName = e.currentTarget.dataset.productName;
                    const productNameUr = e.currentTarget.dataset.productNameUr;
                    const productPrice = parseFloat(e.currentTarget.dataset.productPrice);
                    
                    const defaultWeightInGrams = 1000; 
                    const defaultDisplayWeight = "1 kg"; 

                    addItemToCart(productName, productNameUr, productPrice, defaultWeightInGrams, defaultDisplayWeight);
                });
            });

            if (document.body.classList.contains('admin-mode')) {
                productsGrid.querySelectorAll('.edit-price-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productName = e.currentTarget.dataset.productName;
                        const categoryName = e.currentTarget.dataset.category;
                        editProductPrice(productName, categoryName);
                    });
                });
            }
        }

        // Search Functionality
        const searchInput = document.getElementById('searchInput');
        const searchResultsContainer = document.getElementById('searchResults');

        searchInput.addEventListener('input', () => {
            const query = searchInput.value.toLowerCase();
            searchResultsContainer.innerHTML = '';

            if (query.length > 2) {
                let matches = [];
                for (const category in groceryData) {
                    groceryData[category].forEach(product => {
                        if (product.name.toLowerCase().includes(query) || product.nameUr.toLowerCase().includes(query)) {
                            matches.push({...product, category: category});
                        }
                    });
                }

                if (matches.length > 0) {
                    searchResultsContainer.classList.remove('hidden');
                    matches.forEach(product => {
                        const searchItem = document.createElement('div');
                        searchItem.className = `search-item text-white flex justify-between items-center ${currentLanguage === 'ur' ? 'urdu-font' : ''}`;
                        searchItem.innerHTML = `
                            <span>${currentLanguage === 'ur' ? product.nameUr : product.name}</span>
                            <button class="add-to-cart-btn-search bg-green-500 text-white px-3 py-1 rounded-md text-sm"
                                    data-product-name="${product.name}"
                                    data-category="${product.category}"
                                    data-product-price="${product.price}"
                                    data-product-name-ur="${product.nameUr}">
                                <i class="fas fa-cart-plus"></i> ${translations[currentLanguage].add_to_cart}
                            </button>
                        `;
                        searchItem.querySelector('.add-to-cart-btn-search').addEventListener('click', (e) => {
                            e.stopPropagation();
                            const productName = e.currentTarget.dataset.productName;
                            const productPrice = parseFloat(e.currentTarget.dataset.productPrice);
                            const productNameUr = e.currentTarget.dataset.productNameUr;

                            const defaultWeightInGrams = 1000;
                            const defaultDisplayWeight = "1 kg";

                            addItemToCart(productName, productNameUr, productPrice, defaultWeightInGrams, defaultDisplayWeight);
                            searchResultsContainer.classList.add('hidden');
                            document.getElementById('searchInput').value = '';
                        });
                        searchResultsContainer.appendChild(searchItem);
                    });
                } else {
                    searchResultsContainer.classList.add('hidden');
                }
            } else {
                searchResultsContainer.classList.add('hidden');
            }
        });

        document.addEventListener('click', (e) => {
            if (!searchResultsContainer.contains(e.target) && e.target !== searchInput) {
                searchResultsContainer.classList.add('hidden');
            }
        });

        function addItemToCart(name, nameUr, basePrice, quantityGrams, displayWeight) {
            const existingItemIndex = cart.findIndex(item => item.name === name);

            if (existingItemIndex > -1) {
                updateCartItemQuantity(existingItemIndex, cart[existingItemIndex].quantityGrams + quantityGrams);
            } else {
                const totalItemPrice = (basePrice / 1000) * quantityGrams;
                cart.push({
                    name, nameUr, basePrice,
                    quantityGrams: quantityGrams,
                    displayWeight: displayWeight,
                    totalItemPrice: totalItemPrice
                });
            }
            updateCartDisplay();
        }

        function updateCartItemQuantity(index, newQuantityGrams) {
            if (index < 0 || index >= cart.length) return;

            let item = cart[index];
            item.quantityGrams = newQuantityGrams;
            item.totalItemPrice = (item.basePrice / 1000) * item.quantityGrams;
            item.displayWeight = formatWeight(item.quantityGrams);

            if (item.quantityGrams <= 0) {
                cart.splice(index, 1);
            }
            updateCartDisplay();
        }

        function formatWeight(grams) {
            if (grams >= 1000) {
                const kg = grams / 1000;
                return Number.isInteger(kg) ? kg + ' kg' : kg.toFixed(2) + ' kg';
            }
            return grams + ' g';
        }

        function updateCartDisplay() {
            const cartItemsContainer = document.getElementById('cartItems');
            const cartCountElement = document.getElementById('cartCount');
            const cartTotalElement = document.getElementById('cartTotal');
            let total = 0;
            let itemCount = 0;

            cartItemsContainer.innerHTML = '';

            if (cart.length === 0) {
                cartItemsContainer.innerHTML = `<p class="text-gray-500 text-center py-8 ${currentLanguage === 'ur' ? 'urdu-font' : ''}" data-translate="cart_empty">${translations[currentLanguage].cart_empty}</p>`;
            } else {
                cart.forEach((item, index) => {
                    total += item.totalItemPrice;
                    itemCount++;
                    
                    const cartItemDiv = document.createElement('div');
                    cartItemDiv.className = 'flex justify-between items-center bg-gray-100 p-4 rounded-lg shadow-sm mb-3';
                    cartItemDiv.innerHTML = `
                        <div>
                            <p class="font-semibold text-gray-800 ${currentLanguage === 'ur' ? 'urdu-font' : ''}">${currentLanguage === 'ur' ? item.nameUr : item.name}</p>
                            <p class="text-sm text-gray-600">${item.displayWeight} @ ${formatPrice(item.basePrice)}/kg</p>
                            <p class="text-lg font-bold text-green-600">${formatPrice(item.totalItemPrice)}</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="weight-controls">
                                <button class="weight-btn" data-action="decrease" data-index="${index}" data-amount="250">-250g</button>
                                <button class="weight-btn" data-action="decrease" data-index="${index}" data-amount="100">-100g</button>
                                <span class="weight-display">${item.displayWeight}</span>
                                <button class="weight-btn" data-action="increase" data-index="${index}" data-amount="100">+100g</button>
                                <button class="weight-btn" data-action="increase" data-index="${index}" data-amount="250">+250g</button>
                            </div>
                            <button class="remove-item-btn bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition" data-index="${index}">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(cartItemDiv);
                });
            }

            cartCountElement.textContent = itemCount;
            cartTotalElement.textContent = formatPrice(total);

            cartItemsContainer.querySelectorAll('.remove-item-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    cart.splice(parseInt(e.currentTarget.dataset.index), 1);
                    updateCartDisplay();
                });
            });

            cartItemsContainer.querySelectorAll('.weight-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.dataset.index);
                    const action = e.currentTarget.dataset.action;
                    const amount = parseFloat(e.currentTarget.dataset.amount);
                    
                    let newQuantityGrams = cart[index].quantityGrams;
                    if (action === 'increase') newQuantityGrams += amount;
                    else if (action === 'decrease') newQuantityGrams -= amount;
                    
                    if (newQuantityGrams < 0) newQuantityGrams = 0;
                    updateCartItemQuantity(index, newQuantityGrams);
                });
            });
        }

        document.getElementById('clearCartBtn').addEventListener('click', () => {
            if (confirm(currentLanguage === 'ur' ? 'کیا آپ واقعی کارٹ صاف کرنا چاہتے ہیں؟' : 'Are you sure you want to clear the cart?')) {
                cart = [];
                updateCartDisplay();
            }
        });

        document.getElementById('checkoutBtn').addEventListener('click', () => {
            if (cart.length === 0) {
                alert(currentLanguage === 'ur' ? 'کارٹ خالی ہے۔ براہ کرم اشیاء شامل کریں!' : 'Cart is empty. Please add items!');
                return;
            }
            
            const saleTotal = cart.reduce((sum, item) => sum + item.totalItemPrice, 0);
            const saleItemsCount = cart.length;

            totalSalesToday += saleTotal;
            totalItemsSold += saleItemsCount;
            totalOrders++;

            const newSale = {
                id: Date.now(),
                total: saleTotal,
                items: JSON.parse(JSON.stringify(cart)),
                timestamp: new Date().toLocaleString()
            };
            recentSales.unshift(newSale);
            if (recentSales.length > MAX_RECENT_SALES) recentSales.pop();

            localStorage.setItem('totalSalesToday', totalSalesToday);
            localStorage.setItem('totalItemsSold', totalItemsSold);
            localStorage.setItem('totalOrders', totalOrders);
            localStorage.setItem('recentSales', JSON.stringify(recentSales));

            updateSalesDashboard();
            generateBill();
            
            cart = [];
            updateCartDisplay();
        });

        function updateSalesDashboard() {
            document.getElementById('totalSalesToday').textContent = formatPrice(totalSalesToday);
            document.getElementById('totalItemsSold').textContent = totalItemsSold;
            document.getElementById('totalOrders').textContent = totalOrders;
            const avgValue = totalOrders > 0 ? totalSalesToday / totalOrders : 0;
            document.getElementById('avgOrderValue').textContent = formatPrice(avgValue);

            const recentSalesContainer = document.getElementById('recentSales');
            recentSalesContainer.innerHTML = '';
            if (recentSales.length === 0) {
                recentSalesContainer.innerHTML = `<p class="text-gray-500 text-center py-4 ${currentLanguage === 'ur' ? 'urdu-font' : ''}">${currentLanguage === 'ur' ? 'کوئی حالیہ سیلز نہیں' : 'No recent sales'}</p>`;
            } else {
                recentSales.forEach(sale => {
                    const saleDiv = document.createElement('div');
                    saleDiv.className = 'bg-gray-50 p-3 rounded-lg text-sm flex justify-between items-center';
                    saleDiv.innerHTML = `
                        <span>Order #${sale.id.toString().slice(-4)} (${sale.items.length} items)</span>
                        <span class="font-bold text-green-600">${formatPrice(sale.total)}</span>
                    `;
                    recentSalesContainer.appendChild(saleDiv);
                });
            }
        }

        function loadSalesData() {
            totalSalesToday = parseFloat(localStorage.getItem('totalSalesToday')) || 0;
            totalItemsSold = parseInt(localStorage.getItem('totalItemsSold')) || 0;
            totalOrders = parseInt(localStorage.getItem('totalOrders')) || 0;
            try {
                recentSales = JSON.parse(localStorage.getItem('recentSales')) || [];
            } catch (e) {
                console.error("Error parsing recent sales from localStorage", e);
                recentSales = [];
            }
        }

        document.getElementById('resetSalesBtn').addEventListener('click', () => {
            if (confirm(currentLanguage === 'ur' ? 'کیا آپ واقعی یومیہ سیلز ری سیٹ کرنا چاہتے ہیں؟ یہ کارروائی ناقابل واپسی ہے!' : 'Are you sure you want to reset daily sales? This action is irreversible!')) {
                totalSalesToday = 0;
                totalItemsSold = 0;
                totalOrders = 0;
                recentSales = [];
                localStorage.removeItem('totalSalesToday');
                localStorage.removeItem('totalItemsSold');
                localStorage.removeItem('totalOrders');
                localStorage.removeItem('recentSales');
                updateSalesDashboard();
                alert(currentLanguage === 'ur' ? 'یومیہ سیلز ری سیٹ کر دی گئی ہیں۔' : 'Daily sales have been reset.');
            }
        });

        function editProductPrice(productName, categoryName) {
            const product = groceryData[categoryName].find(p => p.name === productName);
            if (!product) return;

            const newPrice = prompt(`${currentLanguage === 'ur' ? 'نئی قیمت درج کریں (فی کلو/یونٹ)' : 'Enter new price (per kg/unit) for'} ${currentLanguage === 'ur' ? product.nameUr : product.name}:`, product.price);
            if (newPrice !== null && !isNaN(newPrice) && parseFloat(newPrice) >= 0) {
                product.price = parseFloat(newPrice);
                renderProducts(currentCategory);
                alert(`${currentLanguage === 'ur' ? 'قیمت اپ ڈیٹ کر دی گئی ہے۔' : 'Price updated successfully!'}`);
            } else if (newPrice !== null) {
                alert(currentLanguage === 'ur' ? 'غلط قیمت۔' : 'Invalid price entered.');
            }
        }

        const billModal = document.getElementById('billModal');
        const billDetails = document.getElementById('billDetails');
        const billTotalDisplay = document.getElementById('billTotal');
        const closeBillBtn = document.getElementById('closeBill');
        const printBillBtn = document.getElementById('printBill');

        function generateBill() {
            billDetails.innerHTML = '';
            let totalAmount = 0;

            const billContentDiv = document.createElement('div');
            billContentDiv.className = 'bill-print-content';

            const thankYou = translations[currentLanguage].thank_you;
            const visitAgain = translations[currentLanguage].visit_again;
            const billDescription = translations[currentLanguage].bill_description;
            const billWeight = translations[currentLanguage].bill_weight;
            const billPrice = translations[currentLanguage].bill_price;
            const billTotal = translations[currentLanguage].bill_total;
            const billFinalTotal = translations[currentLanguage].bill_final_total;
            
            billContentDiv.innerHTML = `
                <div class="bill-header">
                    <div class="bill-top-heading">
                        <span class="since-text">1982</span>
                        <h1 class="urdu-font">باغ عزیز</h1>
                        <span class="since-text">Since</span>
                    </div>
                    <div class="store-name-subheading urdu-font">
                        <P>حاجی فخرالدین کریانہ اینڈ جنرل ہولسیل اسٹور</P>
                        <p>ہمارے یہاں ہر قسم کے چاول ہر قسم کے دالیں گرم مصالحہ جات اور بہترین ڈرایٔ فروٹ مناسب قیمت پر دستیاب ہیں</p>
                    </div>
                     <p style="font-weight: bold; text-align: center; margin-top: 10px; font-family: 'Poppins', sans-serif;">
                        PHONE:NO 0325-3545682 / 0341-3020958
                     </p>
                </div>
                <table class="bill-table ${currentLanguage === 'ur' ? 'urdu-font' : ''}">
                    <thead>
                        <tr>
                            <th>${billDescription}</th>
                            <th class="text-right">${billWeight}</th>
                            <th class="text-right">${billPrice}</th>
                            <th class="text-right">${billTotal}</th>
                        </tr>
                    </thead>
                    <tbody id="billTableBody">
                    </tbody>
                </table>
                <div class="bill-total">
                    <div class="bill-total-row ${currentLanguage === 'ur' ? 'urdu-font' : ''}">
                        <span>${billFinalTotal}</span>
                        <span id="finalBillTotal"></span>
                    </div>
                </div>
                <div class="bill-footer ${currentLanguage === 'ur' ? 'urdu-font' : ''}">
                    <p>${thankYou}</p>
                    <p>${visitAgain}</p>
                </div>
                <div class="bill-number">Bill # ${Date.now().toString().slice(-6)}</div>
            `;
            
            const billTableBody = billContentDiv.querySelector('#billTableBody');

            cart.forEach(item => {
                totalAmount += item.totalItemPrice;
                const itemRow = document.createElement('tr');
                itemRow.innerHTML = `
                    <td class="${currentLanguage === 'ur' ? 'urdu-font' : ''}">${currentLanguage === 'ur' ? item.nameUr : item.name}</td>
                    <td class="text-right">${item.displayWeight}</td>
                    <td class="text-right">${formatPrice(item.basePrice)}</td>
                    <td class="text-right">${formatPrice(item.totalItemPrice)}</td>
                `;
                billTableBody.appendChild(itemRow);

                const modalItemP = document.createElement('p');
                modalItemP.innerHTML = `<span class="${currentLanguage === 'ur' ? 'urdu-font' : ''}">${currentLanguage === 'ur' ? item.nameUr : item.name}</span> - ${item.displayWeight} - <b>${formatPrice(item.totalItemPrice)}</b>`;
                billDetails.appendChild(modalItemP);
            });

            billTotalDisplay.textContent = formatPrice(totalAmount);
            billContentDiv.querySelector('#finalBillTotal').textContent = formatPrice(totalAmount);

            document.getElementById('billPrintArea').innerHTML = '';
            document.getElementById('billPrintArea').appendChild(billContentDiv);
            document.getElementById('billPrintArea').style.display = 'block';

            billModal.classList.remove('hidden');
            billModal.classList.add('flex');
        }

        closeBillBtn.addEventListener('click', () => {
            billModal.classList.add('hidden');
            billModal.classList.remove('flex');
            document.getElementById('billPrintArea').style.display = 'none';
        });

        printBillBtn.addEventListener('click', () => {
            window.print();
        });

    </script>
</body>
</html>